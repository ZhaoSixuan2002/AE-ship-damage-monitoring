# 损伤可疑度推导

## 1. 问题背景：静态快照检测的虚警问题

### 1.1 单次残差检测的局限性

对于自编码器在健康状态下的重构残差 $r^{(d)} = \hat{x}^{(d)} - x^{(d)}$，假设其服从近似正态分布 $r^{(d)} \sim \mathcal{N}(\mu^{(d)}, \sigma^{(d)})$。

**阈值定义**：基于 $k$-$\sigma$ 准则（默认 $k=3$），定义第 $d$ 维的阈值为：

$$
\tau^{(d)} = |\mu^{(d)}| + k\sigma^{(d)}
$$

### 1.2 单点虚警概率

对于单个维度 $d$，在健康状态下残差超过阈值的概率（单侧虚警）为：

$$
P_{\text{false}}^{(d)} = P(|r^{(d)}| > \tau^{(d)}) \approx 2\Phi(-k) \approx 0.27\% \quad (k=3)
$$

其中 $\Phi$ 为标准正态分布的累积分布函数。

### 1.3 多维虚警概率

对于 $D=252$ 个维度，**至少有一个维度**虚警的概率为：

$$
P_{\text{any\_false}} = 1 - (1 - P_{\text{false}}^{(d)})^D \approx 1 - (1 - 0.0027)^{252} \approx 50.0\%
$$

**结论**：即使在健康状态下，单次快照也有约 **50% 的概率**触发至少 1 个维度超阈值，这不是小概率事件。

![实验证明](output/figures/damage_validation/crack_detection_summary.png)  
*图：裂纹样本每个样本超阈值维度数统计（参见 `combined_residuals_crack.png` 中残差分布）*

### 1.4 问题总结

**静态快照检测**（单次超阈值即警报）存在高虚警率：
- 健康样本也会偶然触发多维度超阈值
- 噪声扰动导致瞬时异常值频繁出现
- 无法区分"持续性异常"与"随机波动"

**解决方案**：引入**时间平滑机制**，用累积趋势替代瞬时快照，构建**损伤可疑度**指标。

---

## 2. 损伤可疑度：基于时间平滑的动态指标

## 2. 损伤可疑度：基于时间平滑的动态指标

### 2.1 重构残差与阈值

对于第 $t$ 个样本的第 $d$ 维特征 $x_t^{(d)}$，自编码器的重构值为 $\hat{x}_t^{(d)}$，定义重构残差为：

$$
r_t^{(d)} = \hat{x}_t^{(d)} - x_t^{(d)}
$$

阈值定义（基于健康状态统计）：

$$
\tau^{(d)} = |\mu^{(d)}| + k\sigma^{(d)}, \quad k=3
$$

### 2.2 超阈值倍数

量化残差相对于阈值的超越程度：

$$
\rho_t^{(d)} = \begin{cases} 
\dfrac{|r_t^{(d)}|}{\tau^{(d)}}, & \text{if } |r_t^{(d)}| > \tau^{(d)} \\[10pt]
0, & \text{otherwise}
\end{cases}
$$

- $\rho_t^{(d)} > 1$：残差超过阈值，异常程度为 $\rho_t^{(d)}$ 倍阈值
- $\rho_t^{(d)} = 0$：残差在正常范围内

### 2.3 滑动窗口平滑

采用窗口大小为 $w$ 的滑动平均抑制瞬时噪声：

$$
\bar{\rho}_t^{(d)} = \frac{1}{w} \sum_{i=t-w+1}^{t} \rho_i^{(d)}
$$

**核心思想**：
- 偶发的噪声虚警被窗口内其他正常样本稀释
- 持续的损伤异常在窗口内累积增强
- 窗口大小 $w=10$ 平衡响应速度与鲁棒性

### 2.4 损伤可疑度定义

第 $t$ 时刻第 $d$ 维的**损伤可疑度** $S_t^{(d)}$：

$$
S_t^{(d)} = \alpha \cdot \bar{\rho}_t^{(d)}
$$

其中 $\alpha$ 为衰减因子（默认 $\alpha = 20$），控制可疑度映射到可视化范围 $[0, 100]$。

---

## 3. 可视化映射

在时历动画中，使用透明度-颜色双重编码：

$$
\text{Opacity}_t^{(d)} = 100 - S_t^{(d)}
$$

$$
\text{Display Value}_t^{(d)} = 100 - \text{Opacity}_t^{(d)} = S_t^{(d)}
$$

- **Opacity = 100%**（完全透明，白色）：健康状态，$S_t^{(d)} = 0$
- **Opacity = 0%**（完全不透明，深红色）：高度可疑，$S_t^{(d)} = 100$

色条标题 **"Damage Suspicion (100 - Opacity %)"** 强调：
- 颜色越深（红色）→ 损伤可疑度越高（持续异常累积）
- 颜色越浅（白色）→ 损伤可疑度越低（正常或偶发噪声）

---

## 4. 核心优势

1. **噪声抑制**：滑动窗口平滑避免单次虚警引起误判，虚警概率从 50% 降至接近 0
2. **累积效应**：真实损伤导致的持续异常在窗口内累积，可疑度逐步上升
3. **多维融合**：每个测点独立计算，支持空间分布可视化
4. **直观解释**：透明度-颜色映射符合工程师对损伤"浮现"的直觉理解

---

## 5. 参数说明

| 参数 | 符号 | 默认值 | 说明 |
|------|------|--------|------|
| 阈值倍数 | $k$ | 3.0 | $k$-$\sigma$ 准则的标准差倍数 |
| 窗口大小 | $w$ | 10 | 滑动窗口样本数 |
| 衰减因子 | $\alpha$ | 20 | 可疑度缩放系数 |

调整这些参数可平衡检测灵敏度与鲁棒性。
